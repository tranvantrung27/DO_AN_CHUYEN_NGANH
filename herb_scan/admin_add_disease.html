<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Herb Scan</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
  <link rel="stylesheet" href="admin_add_disease.css">
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h1>Herb Scan</h1>
    <button id="logoutBtn" class="btn btn-secondary" onclick="logoutAdmin()" style="width: 100%; margin-bottom: 20px; display: none;">
      ğŸšª ÄÄƒng xuáº¥t
    </button>
    
    <!-- Trang chá»§ Section -->
    <div class="sidebar-section">
      <div class="section-title">Trang chá»§</div>
    <div class="menu-item active" onclick="switchTab('diseases')" id="menu-diseases">
        CÃ¡c bá»‡nh
    </div>
    <div class="menu-item" onclick="switchTab('healthy')" id="menu-healthy">
        Sá»‘ng khá»e
      </div>
    </div>
    
    <!-- Kho thuá»‘c Section -->
    <div class="sidebar-section">
      <div class="section-title">Kho thuá»‘c</div>
      <div class="menu-item" onclick="switchTab('herballibrary')" id="menu-herballibrary">
        Kho thuá»‘c
      </div>
    </div>
  </div>

  <!-- Login Section (shown when not logged in) -->
  <div id="loginSection" class="login-section" style="display: none;">
    <div class="login-container">
      <h1>ğŸ” ÄÄƒng nháº­p Admin</h1>
      <div class="form-group">
        <label for="adminEmail">ğŸ“§ Email</label>
        <input type="email" id="adminEmail" placeholder="admin@example.com">
      </div>
      <div class="form-group">
        <label for="adminPassword">ğŸ”’ Máº­t kháº©u</label>
        <input type="password" id="adminPassword" placeholder="Nháº­p máº­t kháº©u">
      </div>
      <button class="btn btn-primary" onclick="loginAdmin()" style="width: 100%; margin-top: 20px;">
        ÄÄƒng nháº­p
      </button>
      <div id="loginStatus" class="status" style="margin-top: 15px;"></div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <div class="container">
      <!-- List View -->
      <div id="listView" class="list-view">
        <div class="list-header">
          <h2 id="listTitle">ğŸ“‹ Danh sÃ¡ch bÃ i viáº¿t - CÃ¡c bá»‡nh</h2>
          <div style="display: flex; gap: 10px;">
            <button id="manageCategoriesBtn" class="btn btn-secondary" onclick="showManageCategories()" style="display: none;">ğŸ“‚ Quáº£n lÃ½ danh má»¥c</button>
            <button class="btn btn-primary" onclick="showAddForm()">ÄÄƒng bÃ i má»›i</button>
          </div>
        </div>
        <div id="articleList" class="article-list">
          <!-- Articles will be loaded here -->
        </div>
      </div>

      <!-- Detail View -->
      <div id="detailView" class="detail-view">
        <button class="btn btn-back" onclick="showList()">â† Quay láº¡i</button>
        <h2 id="detailTitle">Chi tiáº¿t bÃ i viáº¿t</h2>
        <div id="detailContent">
          <!-- Detail content will be loaded here -->
        </div>
      </div>

      <!-- Form View (Add/Edit) -->
      <div id="formView" class="form-view">
        <button class="btn btn-back" onclick="showList()">â† Quay láº¡i</button>
        <h2 id="formTitle">ğŸª´ ÄÄƒng bÃ i má»›i</h2>
        
        <div class="form-group">
          <label for="imageUrl">ğŸ–¼ï¸ áº¢nh (báº¯t buá»™c)</label>
          <div style="display: flex; gap: 10px; align-items: flex-start;">
            <input type="url" id="imageUrl" placeholder="Nháº­p link áº£nh hoáº·c chá»n áº£nh tá»« thÆ° viá»‡n" style="flex: 1;" required oninput="updateImagePreview(this.value)">
            <input type="file" id="imageFile" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('imageFile').click()" style="white-space: nowrap;">
              ğŸ“ Chá»n áº£nh
            </button>
          </div>
          <div id="imagePreview" style="margin-top: 10px; display: none;">
            <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e0e0e0;">
          </div>
        </div>

        <div class="form-group">
          <label for="title">ğŸ“ TiÃªu Ä‘á» lá»›n (báº¯t buá»™c)</label>
          <input type="text" id="title" placeholder="Nháº­p tiÃªu Ä‘á» lá»›n cá»§a bÃ i viáº¿t" required>
        </div>

        <div class="form-group">
          <label for="subtitle">ğŸ“„ TiÃªu Ä‘á» phá»¥ (báº¯t buá»™c)</label>
          <textarea id="subtitle" placeholder="Nháº­p cÃ´ng dá»¥ng cá»§a bÃ i thuá»‘c" required></textarea>

        </div>

        <!-- Category field (only for herballibrary) -->
        <div id="categoryGroup" class="form-group" style="display: none;">
          <label for="category">ğŸ“‚ Triá»‡u chá»©ng thÆ°á»ng gáº·p</label>
          <select id="category" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
            <option value="">-- Chá»n triá»‡u chá»©ng --</option>
            <!-- Categories will be loaded dynamically -->
          </select>
        </div>

        <!-- Date field (only for herballibrary) - Auto-generated, hidden -->
        <div id="dateGroup" class="form-group" style="display: none;">
          <label for="date">ğŸ“… NgÃ y Ä‘Äƒng</label>
          <input type="text" id="date" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
          <small style="color: #666; display: block; margin-top: 4px;">
            ğŸ’¡ NgÃ y sáº½ tá»± Ä‘á»™ng cáº­p nháº­t khi Ä‘Äƒng bÃ i
          </small>
        </div>

        <!-- Related Articles field (only for herballibrary) - Hidden for now -->
        <div id="relatedArticlesGroup" class="form-group" style="display: none;">
          <!-- Temporarily hidden -->
        </div>

        <!-- Tags field (only for herballibrary) - Hidden for now -->
        <div id="tagsGroup" class="form-group" style="display: none;">
          <!-- Temporarily hidden -->
        </div>

        <div id="contentGroup" class="form-group">
          <label for="content">ğŸ“ Ná»™i dung bÃ i viáº¿t (báº¯t buá»™c)</label>
          <small style="color: #666; display: block; margin-bottom: 8px;">
            ğŸ’¡ Sá»­ dá»¥ng cÃ¡c nÃºt bÃªn dÆ°á»›i hoáº·c phÃ­m táº¯t: <strong>Ctrl+B</strong> (in Ä‘áº­m), <strong>Ctrl+I</strong> (in nghiÃªng), <strong>Ctrl+U</strong> (gáº¡ch chÃ¢n), <strong>Ctrl+Shift+S</strong> (gáº¡ch ngang) | <strong>Ctrl+Z</strong> (quay láº¡i), <strong>Ctrl+Y</strong> (lÃ m láº¡i)
          </small>
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('bold')" title="In Ä‘áº­m (Ctrl+B)">
              <strong>B</strong>
            </button>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('italic')" title="In nghiÃªng (Ctrl+I)">
              <em>I</em>
            </button>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('underline')" title="Gáº¡ch chÃ¢n (Ctrl+U) - DÃ¹ng HTML tag">
              <u>U</u>
            </button>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('strikethrough')" title="Gáº¡ch ngang (Ctrl+Shift+S)">
              <s>S</s>
            </button>
            <div style="width: 1px; background: #ddd; margin: 0 4px;"></div>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('h1')" title="TiÃªu Ä‘á» lá»›n">
              H1
            </button>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('h2')" title="TiÃªu Ä‘á» nhá»">
              H2
            </button>
            <button type="button" class="toolbar-btn" onclick="formatTextWithHistory('h3')" title="TiÃªu Ä‘á» nhá» hÆ¡n">
              H3
            </button>
          </div>
          <div class="editor-wrapper">
            <textarea id="content" placeholder="Nháº­p ná»™i dung chi tiáº¿t cá»§a bÃ i viáº¿t..." required style="min-height: 300px;"></textarea>
          </div>
        </div>
        <!-- Note: Content field is hidden for herballibrary -->

        <button id="submitBtn" class="btn btn-primary" onclick="saveDoc()">âœ… LÆ°u bÃ i viáº¿t</button>

        <div id="status" class="status"></div>
      </div>

      <!-- Manage Categories View (only for herballibrary) -->
      <div id="manageCategoriesView" class="form-view">
        <button class="btn btn-back" onclick="showList()">â† Quay láº¡i</button>
        <h2>ğŸ“‚ Quáº£n lÃ½ danh má»¥c - Triá»‡u chá»©ng thÆ°á»ng gáº·p</h2>
        
        <div class="form-group">
          <label for="newCategoryName">TÃªn danh má»¥c má»›i</label>
          <input type="text" id="newCategoryName" placeholder="Nháº­p tÃªn danh má»¥c (vÃ­ dá»¥: HÃ´ háº¥p)">
        </div>

        <div class="form-group">
          <label for="newCategoryImage">ğŸ–¼ï¸ áº¢nh danh má»¥c</label>
          <div style="display: flex; gap: 10px; align-items: flex-start;">
            <input type="url" id="newCategoryImage" placeholder="Nháº­p link áº£nh hoáº·c chá»n áº£nh tá»« thÆ° viá»‡n" style="flex: 1;" oninput="updateCategoryImagePreview(this.value)">
            <input type="file" id="newCategoryImageFile" accept="image/*" style="display: none;" onchange="handleCategoryImageUpload(event)">
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('newCategoryImageFile').click()" style="white-space: nowrap;">
              ğŸ“ Chá»n áº£nh
            </button>
          </div>
          <div id="categoryImagePreview" style="margin-top: 10px; display: none;">
            <img id="categoryPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e0e0e0;">
    </div>
  </div>

        <div class="form-group">
          <button id="categorySubmitBtn" class="btn btn-primary" onclick="saveCategory()">â• ThÃªm danh má»¥c</button>
          <button id="categoryCancelBtn" class="btn btn-secondary" onclick="cancelEditCategory()" style="display: none; margin-left: 10px;">âŒ Há»§y</button>
        </div>

        <div class="form-group">
          <label>Danh sÃ¡ch danh má»¥c</label>
          <div id="categoriesList" class="article-list">
            <!-- Categories will be loaded here -->
              </div>
            </div>
              </div>
                </div>
              </div>

  <script src="admin_add_disease.js"></script>
</body>
</html>
